import{j as e,R as V,g as _,r as q,n as W,u as Q,V as z}from"./index-DjoC8Tjb.js";import{f as d}from"./format-zwvYc4J-.js";import{M as P}from"./MetricCard-ihLxaQMX.js";import{u as Z}from"./useBudgetCalculations-CF5Bm1af.js";const ee=({title:f,value:n,target:v,percentage:c,trend:h="neutral",subtitle:j})=>{const M=c>=50,l=c>=100,i=()=>h==="up"?"üìà":h==="down"?"üìâ":"üí∞",S=()=>l?"from-green-500 to-emerald-600":M?"from-blue-500 to-indigo-600":"from-amber-500 to-orange-600",I=()=>l?"Parab√©ns! Planejamento superado!":M?"Voc√™ est√° no caminho certo!":"Abaixo do planejado";return e.jsxs("div",{className:"card p-8 bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1",children:f}),j&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:j})]}),e.jsx("span",{className:"text-4xl",children:i()})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-5xl font-bold text-gray-900 dark:text-white mb-2",children:d(n)}),v>0&&e.jsxs("div",{className:"text-lg text-gray-600 dark:text-gray-400",children:["de ",d(v)," planejado"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsxs("span",{className:`text-sm font-bold ${l?"text-green-600 dark:text-green-400":M?"text-blue-600 dark:text-blue-400":"text-amber-600 dark:text-amber-400"}`,children:[c.toFixed(1),"% do planejado"]})}),e.jsxs("div",{className:"relative h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 left-0 h-full bg-gradient-to-r ${S()} transition-all duration-1000 ease-out`,style:{width:`${Math.min(c,100)}%`},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-shimmer"})}),c>100&&e.jsx("div",{className:"absolute top-0 h-full w-1 bg-white/50",style:{left:"100%",transform:"translateX(-50%)"}})]}),e.jsx("div",{className:`text-center py-2 rounded-lg font-medium text-sm ${l?"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-400":M?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400":"bg-amber-50 text-amber-700 dark:bg-amber-900/20 dark:text-amber-400"}`,children:I()})]}),v>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Diferen√ßa do planejado"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:v>n?d(v-n):`+${d(n-v)}`})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"M√©dia mensal"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:d(n/(new Date().getMonth()+1))})]})]})]})},te=({data:f,trend:n,color:v,height:c=40,showLabel:h=!0,label:j})=>{if(f.length===0)return e.jsx("div",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Dados insuficientes"});const M=Math.max(...f,1),l=Math.min(...f,0),i=M-l||1,S=100,I=S/(f.length-1||1),u=f.map((t,s)=>{const r=s*I,o=c-(t-l)/i*c;return`${r},${o}`}).join(" "),a=()=>{if(v)return v;switch(n){case"up":return"#22c55e";case"down":return"#ef4444";default:return"#6b7280"}},y=()=>{switch(n){case"up":return"‚Üó";case"down":return"‚Üò";default:return"‚Üí"}},w=()=>n==="up"?"Melhorando":n==="down"?"Piorando":"Est√°vel",T=a();return e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("svg",{viewBox:`0 0 ${S} ${c}`,className:"w-full",preserveAspectRatio:"none",style:{height:`${c}px`},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`gradient-${n}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:T,stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:T,stopOpacity:"0.05"})]})}),e.jsx("polygon",{points:`0,${c} ${u} ${S},${c}`,fill:`url(#gradient-${n})`}),e.jsx("polyline",{points:u,fill:"none",stroke:T,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),f.map((t,s)=>{const r=s*I,o=c-(t-l)/i*c;return e.jsx("circle",{cx:r,cy:o,r:"2",fill:T},s)})]}),h&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:j||"√öltimos meses"}),e.jsxs("span",{className:`font-medium flex items-center gap-1 ${n==="up"?"text-green-600 dark:text-green-400":n==="down"?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400"}`,children:[y()," ",w()]})]})]})},se=({categoryImpacts:f,topSpenders:n,trendingUp:v,trendingDown:c,totalSpent:h,selectedPeriod:j,onPeriodChange:M,periodYear:l,periodMonth:i,currentYear:S,currentMonth:I})=>{const[u,a]=V.useState(new Set),y=t=>{a(s=>{const r=new Set(s);return r.has(t)?r.delete(t):r.add(t),r})},w=t=>{switch(t){case"up":return"‚Üó";case"down":return"‚Üò";case"stable":return"‚Üí"}},T=t=>{switch(t){case"up":return"text-red-600 dark:text-red-400";case"down":return"text-green-600 dark:text-green-400";case"stable":return"text-gray-600 dark:text-gray-400"}};return e.jsxs("div",{className:"space-y-6",children:[(v.length>0||c.length>0)&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[v.length>0&&e.jsxs("div",{className:"card p-6 border-l-4 border-orange-500",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-2xl",children:"üìà"}),e.jsx("h4",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Gastando Mais que o Normal"})]}),e.jsx("div",{className:"space-y-3",children:v.map(t=>{const s=t.spent-t.avg3Months,r=t.avg3Months>0?s/t.avg3Months*100:0;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t.name}),e.jsxs("span",{className:"text-xs text-orange-600 dark:text-orange-400 font-semibold",children:["+",r.toFixed(0),"%"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:["M√©dia 3 meses: ",d(t.avg3Months)]})]}),e.jsxs("div",{className:"text-right flex-shrink-0 ml-3",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 dark:text-white",children:d(t.spent)}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400",children:["+",d(s)]})]})]},t.id)})})]}),c.length>0&&e.jsxs("div",{className:"card p-6 border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-2xl",children:"üìâ"}),e.jsx("h4",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Gastando Menos que o Normal"})]}),e.jsx("div",{className:"space-y-3",children:c.map(t=>{const s=t.avg3Months-t.spent,r=t.avg3Months>0?s/t.avg3Months*100:0;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t.name}),e.jsxs("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-semibold",children:["-",r.toFixed(0),"%"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:["M√©dia 3 meses: ",d(t.avg3Months)]})]}),e.jsxs("div",{className:"text-right flex-shrink-0 ml-3",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 dark:text-white",children:d(t.spent)}),e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:["-",d(s)]})]})]},t.id)})})]})]}),e.jsxs("div",{className:"card p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6 pb-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-white",children:"An√°lise de Categorias"}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1",children:[j==="current"&&`${_(I)} ${S}`,j==="last1"&&`${_(i)} ${l}`,j==="last3"&&"√öltimos 3 meses",j==="last6"&&"√öltimos 6 meses"]})]}),e.jsxs("div",{className:"inline-flex items-center gap-1 p-1 bg-gray-100 dark:bg-gray-800 rounded-lg flex-wrap",children:[e.jsx("button",{onClick:()=>M("current"),className:`px-3 py-1.5 text-xs sm:text-sm font-semibold rounded-md transition-all ${j==="current"?"bg-blue-600 text-white shadow-sm":"text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,children:"Este M√™s"}),e.jsx("button",{onClick:()=>M("last1"),className:`px-3 py-1.5 text-xs sm:text-sm font-semibold rounded-md transition-all ${j==="last1"?"bg-blue-600 text-white shadow-sm":"text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,children:"M√™s Passado"}),e.jsx("button",{onClick:()=>M("last3"),className:`px-3 py-1.5 text-xs sm:text-sm font-semibold rounded-md transition-all ${j==="last3"?"bg-blue-600 text-white shadow-sm":"text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,children:"3 Meses"}),e.jsx("button",{onClick:()=>M("last6"),className:`px-3 py-1.5 text-xs sm:text-sm font-semibold rounded-md transition-all ${j==="last6"?"bg-blue-600 text-white shadow-sm":"text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"}`,children:"6 Meses"})]})]}),n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mb-3",children:e.jsx("svg",{className:"w-16 h-16 mx-auto text-gray-400 dark:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-medium mb-1",children:"Nenhuma despesa registrada"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500",children:"N√£o h√° dados para o per√≠odo selecionado"})]}):e.jsx("div",{className:"space-y-3",children:n.map(t=>{const s=u.has(t.id),r=t.subcategories.length>0;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:`p-4 ${r?"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800":""} transition-colors`,onClick:()=>r&&y(t.id),children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[r&&e.jsx("span",{className:"text-gray-400 dark:text-gray-600 text-sm flex-shrink-0",children:s?"‚ñº":"‚ñ∂"}),e.jsx("h5",{className:"text-base font-bold text-gray-900 dark:text-white truncate",children:t.name}),e.jsx("span",{className:`text-sm flex-shrink-0 ${T(t.trend)}`,children:w(t.trend)}),e.jsxs("span",{className:"text-xs font-semibold text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 px-2 py-0.5 rounded flex-shrink-0",children:[t.impact.toFixed(1),"% do total"]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("div",{className:"text-xl font-bold text-gray-900 dark:text-white whitespace-nowrap",children:[d(t.spent),t.budgeted>0&&e.jsxs("span",{className:"text-xs font-normal text-gray-500 dark:text-gray-400 ml-1",children:["/ ",d(t.budgeted)]})]}),t.avg3Months>0&&t.trend!=="stable"&&e.jsxs("div",{className:`text-sm font-semibold ${t.trend==="up"?"text-orange-600 dark:text-orange-400":"text-blue-600 dark:text-blue-400"}`,children:[t.trend==="up"&&`+${d(t.spent-t.avg3Months)}`,t.trend==="down"&&`-${d(t.avg3Months-t.spent)}`]})]})]}),t.budgeted>0&&e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 cursor-help relative group",title:`${t.percentage.toFixed(0)}% do or√ßamento usado`,children:[e.jsx("div",{className:`h-4 rounded-full transition-all ${t.percentage>105?"bg-red-500":t.percentage>=85?"bg-lime-500":"bg-green-500"}`,style:{width:`${Math.min(t.percentage,100)}%`}}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1.5 bg-gray-900 dark:bg-gray-700 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none z-10",children:[t.percentage.toFixed(0),"% do or√ßamento (",d(t.spent)," de ",d(t.budgeted),")",e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900 dark:border-t-gray-700"})]})]})}),t.topSubcategory&&!s&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:["Principal: ",t.topSubcategory.name," (",d(t.topSubcategory.spent),")"]})]}),s&&r&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 border-t border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"p-4 space-y-2",children:t.subcategories.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:o.name}),e.jsx("span",{className:`text-xs ${T(o.trend)}`,children:w(o.trend)}),o.isOverBudget&&e.jsx("span",{className:"text-xs text-red-600 dark:text-red-400",children:"‚ö†"})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-x-2",children:[e.jsxs("span",{children:[o.impact.toFixed(1),"% do total"]}),o.budgeted>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[o.percentage.toFixed(0),"% do or√ßamento"]})]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0 ml-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:d(o.spent)}),o.avg3Months>0&&o.trend!=="stable"&&e.jsxs("div",{className:`text-xs ${o.trend==="up"?"text-orange-600 dark:text-orange-400":"text-blue-600 dark:text-blue-400"}`,children:[o.trend==="up"?"+":"-",d(Math.abs(o.spent-o.avg3Months))]})]})]},o.id))})})]},t.id)})})]})]})},ae=({totalSpent:f,totalBudgeted:n,avgMonthlySpending:v,daysInMonth:c,daysElapsed:h,projectedSpending:j,isOnTrack:M})=>{const l=h>0?f/h:0,i=n-f,S=c-h,I=S>0&&i>0?i/S:0,u=[];if(u.push({icon:"üìä",label:"Gasto M√©dio Di√°rio",value:d(l),sublabel:v>0?`M√©dia hist√≥rica: ${d(v/30)}/dia`:void 0,color:"text-blue-600 dark:text-blue-400"}),n>0){const a=f/n*100,y=h/c*100,w=a-y;Math.abs(w)<=5?u.push({icon:"‚úì",label:"Ritmo de Gastos",value:"No alvo!",sublabel:`${a.toFixed(0)}% usado em ${y.toFixed(0)}% do m√™s`,color:"text-green-600 dark:text-green-400"}):w>5?u.push({icon:"‚ö°",label:"Ritmo de Gastos",value:"Acelerado",sublabel:`${a.toFixed(0)}% usado em ${y.toFixed(0)}% do m√™s`,color:"text-orange-600 dark:text-orange-400"}):u.push({icon:"üê¢",label:"Ritmo de Gastos",value:"Controlado",sublabel:`${a.toFixed(0)}% usado em ${y.toFixed(0)}% do m√™s`,color:"text-blue-600 dark:text-blue-400"})}if(h>0){const a=j-n;u.push({icon:"üîÆ",label:"Proje√ß√£o do M√™s",value:d(j),sublabel:n>0?a>0?`${d(Math.abs(a))} acima do or√ßamento`:`${d(Math.abs(a))} abaixo do or√ßamento`:void 0,color:a>n*.1?"text-red-600 dark:text-red-400":a<-n*.1?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"})}if(I>0&&S>0){const a=l-I;u.push({icon:"üéØ",label:"Meta Di√°ria Recomendada",value:d(I),sublabel:a>0?`Voc√™ est√° gastando ${d(a)}/dia a mais`:`Continue gastando at√© ${d(I)}/dia`,color:a>I*.2?"text-orange-600 dark:text-orange-400":"text-blue-600 dark:text-blue-400"})}return S>0&&u.push({icon:"üìÖ",label:"Restam",value:`${S} dias`,sublabel:i>0?`${d(i)} de or√ßamento dispon√≠vel`:n>0?"Or√ßamento esgotado":void 0,color:i>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Insights de Gastos Vari√°veis"}),e.jsx("div",{className:"space-y-4",children:u.map((a,y)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-3xl flex-shrink-0 w-10 text-center",children:a.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-0.5",children:a.label}),e.jsx("div",{className:`text-base font-bold ${a.color}`,children:a.value}),a.sublabel&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:a.sublabel})]})]},y))})]})},re=(f,n,v,c)=>q.useMemo(()=>{let h=0,j=0,M=0,l=0;const i=new Date,S=i.getFullYear()===v,I=i.getMonth()+1,u=S&&I===c?c-1:c;let a=0;for(let r=1;r<=u;r++){const o=f.filter(x=>W(x.date,v,r)),C=n.filter(x=>x.year===v&&x.month===r),E=o.some(x=>x.type==="expense"),$=o.some(x=>x.type==="earning"),Y=C.some(x=>x.type==="expense"),D=C.some(x=>x.type==="income");!E&&!$&&!Y&&!D||(a++,o.forEach(x=>{x.type==="earning"?h+=x.value:j+=x.value}),C.forEach(x=>{x.type==="income"?M+=x.amount:l+=x.amount}))}const y=a,w=h-j,T=M-l,t=T>0&&y>0?w/T*100:0,s=h>0?w/h*100:0;return{totalIncome:h,totalExpense:j,totalSavings:w,budgetedIncome:M,budgetedExpense:l,budgetedSavings:T,savingsPercentage:t,savingsRate:s,monthsCompleted:y,averageMonthlyIncome:y>0?h/y:0,averageMonthlyExpense:y>0?j/y:0,averageMonthlySavings:y>0?w/y:0}},[f,n,v,c]),ne=(f,n,v,c,h)=>q.useMemo(()=>{const j=f.filter(t=>W(t.date,c,h)),M=n.filter(t=>t.year===c&&t.month===h),l=j.filter(t=>t.type==="expense").reduce((t,s)=>t+s.value,0),i=v.filter(t=>!t.parentId),I=(()=>{const t=[],s=new Date,r=s.getFullYear(),o=s.getMonth()+1;for(let C=1;C<=10&&!(t.length>=3);C++){let E=h-C,$=c;if(E<=0&&(E+=12,$-=1),$>r||$===r&&E>=o)continue;const Y=f.filter(x=>W(x.date,$,E)),D=n.filter(x=>x.year===$&&x.month===E);(Y.some(x=>x.type==="expense")||D.some(x=>x.type==="expense"))&&t.push(Y)}return t})(),u=I.length,a=i.map(t=>{const s=v.filter(g=>g.parentId===t.id),r=s.map(g=>{const b=j.filter(p=>p.type==="expense"&&p.subgroupId===g.id).reduce((p,k)=>p+k.value,0),N=M.filter(p=>p.type==="expense"&&p.subgroupId===g.id).reduce((p,k)=>p+k.amount,0),B=I.map(p=>p.filter(k=>k.type==="expense"&&k.subgroupId===g.id).reduce((k,H)=>k+H.value,0)),A=u>0?B.reduce((p,k)=>p+k,0)/u:0,G=A===0?"stable":b>A*1.1?"up":b<A*.9?"down":"stable",L=N>0?b/N*100:0,m=l>0?b/l*100:0;return{id:g.id,name:g.name,spent:b,budgeted:N,percentage:L,isOverBudget:L>105,impact:m,avg3Months:A,trend:G}}).filter(g=>g.spent>0).sort((g,b)=>b.spent-g.spent),o=j.filter(g=>g.type==="expense"&&(g.groupId===t.id||g.subgroupId&&s.some(b=>b.id===g.subgroupId))).reduce((g,b)=>g+b.value,0),C=M.filter(g=>g.type==="expense"&&(g.groupId===t.id||g.subgroupId&&s.some(b=>b.id===g.subgroupId))).reduce((g,b)=>g+b.amount,0),E=I.map(g=>g.filter(b=>b.type==="expense"&&(b.groupId===t.id||b.subgroupId&&s.some(N=>N.id===b.subgroupId))).reduce((b,N)=>b+N.value,0)),$=u>0?E.reduce((g,b)=>g+b,0)/u:0,Y=$===0?"stable":o>$*1.1?"up":o<$*.9?"down":"stable",D=C>0?o/C*100:0,x=l>0?o/l*100:0;return{id:t.id,name:t.name,spent:o,budgeted:C,percentage:D,isOverBudget:D>105,impact:x,subcategories:r,topSubcategory:r[0],avg3Months:$,trend:Y}}).filter(t=>t.spent>0).sort((t,s)=>s.spent-t.spent),y=a,w=a.filter(t=>t.trend==="up"&&t.spent>0).sort((t,s)=>s.spent-s.avg3Months-(t.spent-t.avg3Months)).slice(0,5),T=a.filter(t=>t.trend==="down"&&t.avg3Months>0).sort((t,s)=>s.avg3Months-s.spent-(t.avg3Months-t.spent)).slice(0,5);return{totalSpent:l,categoryImpacts:a,topSpenders:y,trendingUp:w,trendingDown:T}},[f,n,v,c,h]),xe=({transactions:f,budgets:n,categories:v})=>{const{setViewMode:c}=Q(),[h,j]=V.useState("current"),M=new Date,l=M.getFullYear(),i=M.getMonth()+1,{periodYear:S,periodMonth:I}=V.useMemo(()=>{if(h==="current")return{periodYear:l,periodMonth:i};if(h==="last1"){let s=i-1,r=l;return s===0&&(s=12,r-=1),{periodYear:r,periodMonth:s}}else if(h==="last3"){let s=i-1,r=l;return s===0&&(s=12,r-=1),{periodYear:r,periodMonth:s}}else if(h==="last6"){let s=i-1,r=l;return s===0&&(s=12,r-=1),{periodYear:r,periodMonth:s}}return{periodYear:l,periodMonth:i}},[h,l,i]),u=re(f,n,l,i),{monthSummary:a}=Z(f,n,v,l,i),y=ne(f,n,v,S,I),w=V.useMemo(()=>{const s=[],r=new Date,o=r.getFullYear(),C=r.getMonth()+1;for(let E=1;E<=10&&s.length<3;E++){let $=i-E,Y=l;if($<=0&&($+=12,Y-=1),Y>o||Y===o&&$>=C)continue;const D=f.filter(N=>{const B=new Date(N.date);return B.getFullYear()===Y&&B.getMonth()+1===$}),x=n.filter(N=>N.year===Y&&N.month===$);if(D.length===0&&x.length===0)continue;const g=D.filter(N=>N.type==="earning").reduce((N,B)=>N+B.value,0),b=D.filter(N=>N.type==="expense").reduce((N,B)=>N+B.value,0);s.unshift(g-b)}return s},[f,n,l,i]),T=V.useMemo(()=>{if(w.length<2)return"neutral";const s=w[w.length-1],r=w[w.length-2];return s>r?"up":s<r?"down":"neutral"},[w]),t=V.useMemo(()=>{const s=new Date,r=s.getFullYear()===l&&s.getMonth()+1===i,o=new Date(l,i,0).getDate(),C=r?s.getDate():o,E=f.filter(m=>{const p=new Date(m.date);return p.getFullYear()===l&&p.getMonth()+1===i}),$=n.filter(m=>m.year===l&&m.month===i&&m.type==="expense"),Y=$.filter(m=>m.isFixedCost).reduce((m,p)=>m+p.amount,0),D=$.filter(m=>!m.isFixedCost).reduce((m,p)=>m+p.amount,0),x=m=>{if(m.type!=="expense")return!1;const p=n.find(k=>k.type!=="expense"||k.year!==l||k.month!==i?!1:m.subgroupId?k.groupId===m.groupId&&k.subgroupId===m.subgroupId:k.groupId===m.groupId&&!k.subgroupId);return(p==null?void 0:p.isFixedCost)||!1},g=E.filter(m=>m.type==="expense"&&x(m)).reduce((m,p)=>m+p.value,0),b=E.filter(m=>m.type==="expense"&&!x(m)).reduce((m,p)=>m+p.value,0);let N=0,B=0;for(let m=1;m<=10&&B<3;m++){let p=i-m,k=l;if(p<=0&&(p+=12,k-=1),k>s.getFullYear()||k===s.getFullYear()&&p>=s.getMonth()+1)continue;const H=f.filter(F=>{const O=new Date(F.date);return O.getFullYear()===k&&O.getMonth()+1===p}),U=n.filter(F=>F.year===k&&F.month===p),X=H.some(F=>F.type==="expense"),J=U.some(F=>F.type==="expense");if(!X&&!J)continue;const K=H.filter(F=>{if(F.type!=="expense")return!1;const O=n.find(R=>R.type!=="expense"||R.year!==k||R.month!==p?!1:F.subgroupId?R.groupId===F.groupId&&R.subgroupId===F.subgroupId:R.groupId===F.groupId&&!R.subgroupId);return!(O!=null&&O.isFixedCost)}).reduce((F,O)=>F+O.value,0);N+=K,B++}N=B>0?N/B:0;const A=C>0?b/C:0,G=r?A*o:b,L=D>0?G<=D:!0;return{totalSpent:b,totalBudgeted:a.budgetedExpense,avgMonthlySpending:N,daysInMonth:o,daysElapsed:C,projectedSpending:G,isOnTrack:L,fixedExpenses:g,fixedBudgeted:Y,variableBudgeted:D,totalExpenses:a.totalExpense}},[f,n,a,l,i]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ee,{title:"Economia Acumulada",value:u.totalSavings,target:u.budgetedSavings,percentage:u.savingsPercentage,trend:u.totalSavings>0?"up":u.totalSavings<0?"down":"neutral",subtitle:`${u.monthsCompleted} ${u.monthsCompleted===1?"m√™s":"meses"} completo${u.monthsCompleted===1?"":"s"}`}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"M√™s Atual"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(P,{label:"Receitas",value:d(a.totalIncome),sublabel:`${a.budgetedIncome>0?(a.totalIncome/a.budgetedIncome*100).toFixed(0):0}% do planejado`,status:a.totalIncome>=a.budgetedIncome?"positive":"neutral",icon:"üíµ",onClick:()=>c(z.MONTH)}),e.jsx(P,{label:"Despesas",value:d(a.totalExpense),sublabel:`${a.budgetedExpense>0?(a.totalExpense/a.budgetedExpense*100).toFixed(0):0}% do or√ßamento`,status:a.totalExpense<=a.budgetedExpense?"positive":"negative",icon:"üí≥",onClick:()=>c(z.MONTH)}),e.jsx(P,{label:"Saldo",value:d(a.netBalance),sublabel:a.netBalance>=0?"Economizando!":"D√©ficit",status:a.netBalance>=0?"positive":"negative",icon:"üí∞",onClick:()=>c(z.MONTH)})]})]}),t.totalExpenses>0&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Custos Fixos vs Vari√°veis"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"üìå"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Custos Fixos"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:d(t.fixedExpenses)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["de ",d(t.fixedBudgeted)," or√ßado"]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[t.totalExpenses>0?(t.fixedExpenses/t.totalExpenses*100).toFixed(0):0,"% do total"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"üí∏"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Gastos Vari√°veis"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:d(t.totalSpent)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["de ",d(t.variableBudgeted)," or√ßado"]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[t.totalExpenses>0?(t.totalSpent/t.totalExpenses*100).toFixed(0):0,"% do total"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(ae,{totalSpent:t.totalSpent,totalBudgeted:t.variableBudgeted,avgMonthlySpending:t.avgMonthlySpending,daysInMonth:t.daysInMonth,daysElapsed:t.daysElapsed,projectedSpending:t.projectedSpending,isOnTrack:t.isOnTrack}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Tend√™ncia Recente"}),e.jsx(te,{data:w,trend:T,label:"√öltimos 3 meses",height:80}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Taxa de Poupan√ßa"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[u.savingsRate.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"M√©dia Mensal"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:d(u.averageMonthlySavings)})]})]})]})]}),e.jsx(se,{categoryImpacts:y.categoryImpacts,topSpenders:y.topSpenders,trendingUp:y.trendingUp,trendingDown:y.trendingDown,totalSpent:y.totalSpent,selectedPeriod:h,onPeriodChange:j,periodYear:S,periodMonth:I,currentYear:l,currentMonth:i})]})};export{xe as OverviewTab};
